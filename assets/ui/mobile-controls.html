<!-- ========================================
  HYTOPIA SDK-COMPLIANT MOBILE CONTROLS
  Dodge Ball - Action Sports Game

  Based on HYTOPIA_MOBILE_CONTROLS_GUIDE.md
======================================== -->

<div class="mobile-controls" id="mobile-controls">
  <div class="mobile-left-controls">
    <button id="mobile-sprint-btn" class="mobile-btn sprint-btn" aria-label="Sprint">
      <span class="btn-icon">&#x1F3C3;</span>
      <span class="btn-label">RUN</span>
    </button>
  </div>

  <div class="mobile-right-controls">
    <div class="mobile-btn-row top-row">
      <button id="mobile-catch-btn" class="mobile-btn catch-btn" aria-label="Catch">
        <span class="btn-icon">&#x1F91A;</span>
        <span class="btn-label">CATCH</span>
      </button>
      <button id="mobile-dodge-btn" class="mobile-btn dodge-btn" aria-label="Dodge">
        <span class="btn-icon">&#x21AA;</span>
        <span class="btn-label">DODGE</span>
      </button>
    </div>
    <div class="mobile-btn-row bottom-row">
      <button id="mobile-throw-btn" class="mobile-btn throw-btn primary-action" aria-label="Throw">
        <span class="btn-icon">&#x1F3C0;</span>
        <span class="btn-label">THROW</span>
      </button>
    </div>
  </div>
</div>

<style>
  .mobile-controls { display: none; }

  body.mobile .mobile-controls,
  body.mobile.gameplay-active .mobile-controls {
    display: block;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 2000;
  }

  body.mobile .mobile-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 68px; height: 68px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.65);
    border: 3px solid rgba(255, 255, 255, 0.35);
    backdrop-filter: blur(8px);
    color: white;
    pointer-events: auto;
    touch-action: none;
    -webkit-touch-callout: none;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
    transition: transform 0.1s ease;
  }

  body.mobile .mobile-btn:active,
  body.mobile .mobile-btn.active {
    transform: scale(0.88);
    background: rgba(0, 0, 0, 0.85);
  }

  body.mobile .btn-icon { font-size: 22px; margin-bottom: 2px; }
  body.mobile .btn-label { font-size: 9px; font-weight: 700; }

  body.mobile .mobile-left-controls { position: fixed; left: 25px; bottom: 130px; }
  body.mobile .mobile-right-controls { position: fixed; right: 20px; bottom: 40px; }
  body.mobile .mobile-btn-row { display: flex; gap: 12px; justify-content: flex-end; margin-bottom: 12px; }
  body.mobile .mobile-btn.primary-action { width: 85px; height: 85px; }
  body.mobile .primary-action .btn-icon { font-size: 30px; }

  /* Throw - Red */
  body.mobile .throw-btn {
    background: linear-gradient(145deg, rgba(220, 60, 60, 0.85), rgba(180, 40, 40, 0.9));
    border-color: rgba(255, 100, 100, 0.6);
  }
  body.mobile .throw-btn.active { box-shadow: 0 0 25px rgba(255, 80, 80, 0.5); }

  /* Catch - Green */
  body.mobile .catch-btn {
    background: linear-gradient(145deg, rgba(50, 180, 100, 0.85), rgba(30, 150, 80, 0.9));
    border-color: rgba(100, 220, 150, 0.6);
  }

  /* Dodge - Blue */
  body.mobile .dodge-btn {
    background: linear-gradient(145deg, rgba(50, 130, 220, 0.85), rgba(30, 100, 180, 0.9));
    border-color: rgba(100, 170, 255, 0.6);
  }

  /* Sprint - Yellow */
  body.mobile .sprint-btn {
    background: linear-gradient(145deg, rgba(230, 180, 50, 0.85), rgba(200, 150, 30, 0.9));
    border-color: rgba(255, 220, 100, 0.6);
  }

  @media (max-height: 500px) {
    body.mobile .mobile-btn { width: 55px; height: 55px; }
    body.mobile .mobile-btn.primary-action { width: 70px; height: 70px; }
    body.mobile .btn-icon { font-size: 18px; }
  }
</style>

<script>
(function() {
  'use strict';
  const isMobile = document.body.classList.contains('mobile') || (window.hytopia && window.hytopia.isMobile);
  if (!isMobile) return;

  const BUTTONS = {
    'mobile-throw-btn':  { input: 'ml', behavior: 'hold', name: 'Throw' },
    'mobile-catch-btn':  { input: 'mr', behavior: 'hold', name: 'Catch' },
    'mobile-dodge-btn':  { input: 'sp', behavior: 'tap',  name: 'Dodge' },
    'mobile-sprint-btn': { input: 'sh', behavior: 'hold', name: 'Sprint' }
  };

  function setupButton(id, cfg) {
    const btn = document.getElementById(id);
    if (!btn) return;
    let pressed = false, touchId = null;

    function press(tid) {
      if (pressed) return;
      pressed = true; touchId = tid;
      btn.classList.add('active');
      if (window.hytopia?.pressInput) window.hytopia.pressInput(cfg.input, true);
      if (cfg.behavior === 'tap') setTimeout(() => release(tid), 150);
    }

    function release(tid) {
      if (!pressed || (tid !== undefined && tid !== touchId)) return;
      pressed = false; touchId = null;
      btn.classList.remove('active');
      if (window.hytopia?.pressInput) window.hytopia.pressInput(cfg.input, false);
    }

    btn.addEventListener('touchstart', e => { e.preventDefault(); press(e.changedTouches[0].identifier); }, { passive: false });
    btn.addEventListener('touchend', e => { e.preventDefault(); for (const t of e.changedTouches) if (t.identifier === touchId) release(t.identifier); }, { passive: false });
    btn.addEventListener('touchcancel', e => { for (const t of e.changedTouches) if (t.identifier === touchId) release(t.identifier); }, { passive: false });
    btn.addEventListener('mousedown', e => { e.preventDefault(); press(-1); });
    btn.addEventListener('mouseup', () => release(-1));
    btn.addEventListener('mouseleave', () => { if (pressed) release(-1); });
    btn.addEventListener('contextmenu', e => e.preventDefault());
  }

  setTimeout(() => { for (const [id, cfg] of Object.entries(BUTTONS)) setupButton(id, cfg); }, 100);
})();
</script>
